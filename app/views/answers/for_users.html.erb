
<h1>Coding Results: "<%=@sampletag%>" Sampleset</h1>
<p>
Showing coding results (<%=(@selected_questions.collect { |q| q.title}).join(", ")%>) from <%= @user_id_to_name.values.join(", ") %>.
</p>
<table class="table table-striped" id="uwc-answers-list">
  <thead>
    <tr>
      <th>ID</th>
      <th>Info</th>
<% @selected_questions.each do |q| %>
      <th style="text-align:center;">
      	<%=q.title%>?
      </th>      
<% end %>
    </tr>
  </thead>
  <tbody>
    <% @articles.each do |article| %>
      <tr>
        <td><%= article.id %></td>
        <td>
        	<b><%= link_to article.headline, article_path(article) %></b><br />
        	<%= article.pub_date %>, <%= article.byline %>, <%= article.source %>
        </td>
<% @selected_questions.each do |q| %>
        <td id="wrapped-article-<%=article.id%>-<%=q.id%>"><%= render :partial => 'answer_icons', :locals=> {
        			:question=>q,
        			:agreement_info=>@agreement_by_article[article.id][q.id],
        			:answers=>article.answers_to_question(q.id),
        			:gold=>article.gold_for_question(q.id),
        			:username_map=>@user_id_to_name
        			} %>
        </td>
<% end %>
      </tr>
    <% end %>
  </tbody>
</table>


<script type="text/javascript">
//<![CDATA[

function initTooltips(parentSelector){
	$(parentSelector+" [rel='tooltip']").tooltip();
}
function initSelect(parentSelector){
	$(parentSelector+" select").change(updateGold)
}
function updateGold(evt){
	answer = $(evt.target).val();
	parts = $(evt.target).closest('form')[0].id.split('_');
	gold_id = parts[2];
	td_id = $(evt.target).closest('td')[0].id;
	article_parts = td_id.split('-');
	article_id = article_parts[2];
	question_id = article_parts[3];
	gold_data = { 'id':gold_id,'question_id':question_id };
	gold_data['gold[id]'] = gold_id;
	gold_data['gold[answer]'] = answer;
	loadingFadeIn();
	$.ajax({
		url:'/golds/'+gold_id+'.json',
		dataType: 'text',
		data: gold_data,
		type: 'PUT',
		error: function (jqXHR, textStatus, errorThrown){
			console.log('error '+errorThrown);
		},
		statusCode: {
			// once it has saved, update the table-cell display
			200: function() {
				loadingFadeOut();
				var tdSelector = '#'+td_id; 
				$(tdSelector).load('/answers/for_article/'+article_id+'/'+question_id,
					{'uids':[<%=@user_id_to_name.keys.join(",")%>]},
					function(){
						// attach listeners to new element  
						initTooltips(tdSelector);
						initSelect(tdSelector);
					}
				);

			}
		}
	});
}

$(initTooltips(""));
$(initSelect(""));

$(function(){$("table").stickyTableHeaders();});

//]]>
</script>